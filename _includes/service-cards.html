{% assign services = site.data.services | sort: "order" %}
{% assign cards_id = include.instance | default: "default" %}
{% assign container_id = "service-cards-" | append: cards_id %}
{% assign filtered_services = services %}
{% if include.featured_only %}
  {% assign filtered_services = services | where: "featured", true %}
{% endif %}

<div id="{{ container_id }}" class="service-cards-wrap">
  {% if include.enable_filters %}
    <nav class="service-filters" aria-label="서비스 상태 필터">
      <button class="service-filter is-active" type="button" data-filter="all">전체</button>
      <button class="service-filter" type="button" data-filter="active">Active</button>
      <button class="service-filter" type="button" data-filter="building">Building</button>
      <button class="service-filter" type="button" data-filter="archived">Archived</button>
    </nav>
  {% endif %}

<div class="service-grid">
  {% for service in filtered_services %}
    <article class="service-card" data-status="{{ service.status | downcase }}">
      <div class="service-card__logo service-card__logo--{{ service.logo_style | default: 'indigo' }}" aria-hidden="true">
        {{ service.logo_text | default: service.name | upcase | truncate: 2, '' }}
      </div>
      <header class="service-card__header">
        <h3>{{ service.name }}</h3>
        <span class="service-status service-status--{{ service.status | downcase }}">{{ service.status }}</span>
      </header>
      <p class="service-card__one-liner">{{ service.one_liner }}</p>
      <p class="service-card__desc">{{ service.description }}</p>
      <div class="service-card__actions">
        <a class="btn btn--primary" href="{{ service.repo_url }}" rel="noopener noreferrer">GitHub</a>
        {% if service.download_url %}
          <a class="btn btn--inverse" href="{{ service.download_url }}" rel="noopener noreferrer">다운로드</a>
        {% endif %}
        <a class="btn btn--inverse" href="{{ '/legal/' | append: service.id | append: '/privacy/' | relative_url }}">개인정보처리방침</a>
        <a class="btn btn--inverse" href="{{ '/legal/' | append: service.id | append: '/terms/' | relative_url }}">이용약관</a>
      </div>
    </article>
  {% endfor %}
</div>
</div>

{% if include.enable_filters %}
<script>
  (function () {
    var root = document.getElementById('{{ container_id }}');
    if (!root) return;

    var buttons = root.querySelectorAll('.service-filter');
    var cards = root.querySelectorAll('.service-card');

    function setFilter(filter) {
      cards.forEach(function (card) {
        var status = card.getAttribute('data-status') || '';
        var visible = filter === 'all' || status === filter;
        card.style.display = visible ? '' : 'none';
      });
      buttons.forEach(function (btn) {
        btn.classList.toggle('is-active', btn.getAttribute('data-filter') === filter);
      });
    }

    buttons.forEach(function (btn) {
      btn.addEventListener('click', function () {
        setFilter(btn.getAttribute('data-filter'));
      });
    });

    setFilter('all');
  })();
</script>
{% endif %}
